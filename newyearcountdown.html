<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>Global New Year Countdown</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <style>
    html, body {
      margin: 0;
      padding: 0;
      height: 100%;
      background: black;
      color: white;
      font-family: Arial, Helvetica, sans-serif;
    }

    .container {
      height: 100%;
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      text-align: center;
      padding: 24px;
    }

    h1 {
      font-size: 42px;
      letter-spacing: 2px;
      margin-bottom: 12px;
    }

    .offsetLine {
      font-size: 22px;
      opacity: 0.9;
      margin-bottom: 18px;
      max-width: 1000px;
      line-height: 1.35;
    }

    .countdown {
      font-size: 84px;
      font-weight: 800;
      letter-spacing: 3px;
      font-variant-numeric: tabular-nums;
    }

    .start-btn {
      margin-top: 30px;
      padding: 14px 26px;
      font-size: 18px;
      background: white;
      color: black;
      border: none;
      border-radius: 6px;
      cursor: pointer;
    }
    .start-btn:hover { background: #ddd; }

    .hint {
      margin-top: 22px;
      font-size: 14px;
      opacity: 0.6;
      max-width: 980px;
      line-height: 1.45;
    }
  </style>
</head>

<body>
  <div class="container">
    <h1>New Year’s Countdown</h1>
    <div class="offsetLine" id="offsetLine">Loading…</div>
    <div class="countdown" id="timer">--d --:--:--</div>

    <button class="start-btn" id="startAudio">▶ Start Music</button>

    <div class="hint">
      Press <b>SPACE</b> to pause / unpause music<br/>
      Uses real-world fixed UTC offsets (no experimental offsets)
    </div>
  </div>

  <script>
    /* -------- AUDIO -------- */
    let audioUnlocked = false;
    const bgMusic = new Audio("music.mp3");
    bgMusic.loop = true;
    bgMusic.volume = 0.5;

    document.getElementById("startAudio").addEventListener("click", () => {
      bgMusic.play().then(() => {
        audioUnlocked = true;
        document.getElementById("startAudio").style.display = "none";
      });
    });

    document.addEventListener("keydown", e => {
      if (e.code === "Space") {
        e.preventDefault();
        if (!audioUnlocked) return;
        bgMusic.paused ? bgMusic.play() : bgMusic.pause();
      }
    });

    /* -------- OFFSETS -------- */
    const offsetSet = new Set();

    // Whole-hour offsets
    for (let h = 14; h >= -10; h--) offsetSet.add(h * 60);

    // Common real-world fractional offsets
    [
      10*60 + 30, // Lord Howe
      9*60  + 30, // Adelaide / Darwin
      8*60  + 45, // Eucla
      6*60  + 30, // Myanmar
      5*60  + 45, // Nepal
      5*60  + 30, // India / Sri Lanka
      4*60  + 30, // Afghanistan
      3*60  + 30, // Iran
      -3*60 - 30, // Newfoundland
      -9*60 - 30  // Marquesas
    ].forEach(m => offsetSet.add(m));

    const OFFSET_CITY = {
      840: "Kiritimati",
      780: "Auckland",
      720: "Auckland",
      660: "Nouméa",
      630: "Lord Howe Island",
      600: "Brisbane",
      570: "Adelaide / Darwin",
      540: "Tokyo",
      525: "Eucla",
      480: "Shanghai",
      420: "Bangkok",
      390: "Yangon",
      360: "Dhaka",
      345: "Kathmandu",
      330: "New Delhi",
      300: "Karachi",
      270: "Kabul",
      240: "Dubai",
      210: "Tehran",
      180: "Moscow",
      120: "Johannesburg",
      60:  "Lagos",
      0:   "London",
      -60: "Praia",
      -120:"South Georgia",
      -180:"São Paulo",
      -210:"St. John’s",
      -240:"Santiago",
      -300:"New York",
      -360:"Chicago",
      -420:"Denver",
      -480:"Los Angeles",
      -540:"Anchorage",
      -570:"Marquesas",
      -600:"Honolulu"
    };

    const OFFSETS = Array.from(offsetSet).map(mins => ({
      mins,
      city: OFFSET_CITY[mins] || "Representative City"
    }));

    function formatOffset(mins) {
      const sign = mins >= 0 ? "+" : "-";
      const abs = Math.abs(mins);
      return `UTC ${sign}${String(Math.floor(abs/60)).padStart(2,"0")}:${String(abs%60).padStart(2,"0")}`;
    }

    function getNextNewYearUtcMs(mins) {
      const now = Date.now();
      const local = new Date(now + mins * 60000);
      const year = local.getUTCFullYear() + 1;
      return { 
        targetUtc: Date.UTC(year, 0, 1) - mins * 60000,
        year
      };
    }

    function formatDHMS(ms) {
      const t = Math.max(0, Math.floor(ms / 1000));
      const d = Math.floor(t / 86400);
      const h = String(Math.floor((t % 86400) / 3600)).padStart(2,"0");
      const m = String(Math.floor((t % 3600) / 60)).padStart(2,"0");
      const s = String(t % 60).padStart(2,"0");
      return `${d}d ${h}:${m}:${s}`;
    }

    function tick() {
      const now = Date.now();
      let next = null;

      OFFSETS.forEach(o => {
        const { targetUtc, year } = getNextNewYearUtcMs(o.mins);
        const diff = targetUtc - now;
        if (!next || diff < next.diff) next = { ...o, diff, year };
      });

      document.getElementById("offsetLine").textContent =
        `${formatOffset(next.mins)} — ${next.city} reaches New Year ${next.year} next`;

      document.getElementById("timer").textContent = formatDHMS(next.diff);
    }

    tick();
    setInterval(tick, 1000);
  </script>
</body>
</html>
